# 内联函数解析

## 什么是内联函数

在C语言中，如果一些函数被频繁调用，不断地有函数入栈，即函数栈，会造成 **栈空间** 或 **栈内存** 的大量消耗。

为了解决这个问题，特别的引入了 **inline修饰符**，表示为 **内联函数**。

栈空间就是指放置程式的局部数据也就是 **函数内数据** 的内存空间，在系统下，栈空间是有限的，假如频繁大量的使用就会造成因栈空间不足所造成的程式出错的问题，函数的死循环递归调用的最终结果就是导致栈内存空间枯竭。

## 一个内联函数的例子

```c

#include <stdio.h>  

//函数定义为inline即:内联函数  
inline char* dbtest(int a) {  
	return (i % 2 > 0) ? "奇" : "偶";  
}   

int main() {  
	int i = 0;  
	for (i=1; i < 100; i++)
	{  
		printf("i:%d    奇偶性:%s /n", i, dbtest(i));      
	}  
}
```

上面的例子就是标准的内联函数的用法，使用inline修饰带来的好处我们表面看不出来，其实在内部的工作就是在每个for循环的内部任何调用dbtest(i)的地方都换成了(i%2>0)?"奇":"偶"这样就 **避免了频繁调用函数对栈内存重复开辟所带来的消耗**,使 dbtest 函数中的代码直接被放到main 函数中，执行for 循环时，会不断调用这段代码，而 **不是不断地开辟一个函数栈**。

## 内联函数的编程风格

> [!TIP|style:flat|label:必须与函数定义体放在一起]
> 关键字inline 必须 **与函数定义体放在一起** 才能使函数成为内联，仅将inline **放在函数声明前面不起任何作用**, inline 是一种 **用于实现的关键字**，而不是一种 **用于声明的关键字**

**如下风格不能成为内联函数**

```c
inline void Foo(int x, int y); // inline 仅与函数声明放在一起
void Foo(int x, int y) {
}
```

**如下风格是内联函数**

```c
void Foo(int x, int y);
inline void Foo(int x, int y) {  // inline 与函数定义体放在一起
}
```

> [!NOTE|style:flat|label:内联函数注意事项]
> **inline不应该出现在函数的声明中**。这个细节虽然不会影响函数的功能，但是体现了高质量C++/C 程序设计风格的一个基本原则：**声明与定义不可混为一谈**，用户没有必要、也不应该知道函数是否需要内联。

> inline只适合 **涵数体内代码简单的函数** 使用，不能包含复杂的结构控制语句例如while、switch，并且内联函数 **本身不能是直接递归函数**

> 内联是以 **代码膨胀（复制）为代价**，仅仅省去了函数调用的开销，从而提高函数的执行效率。如果执行函数体内代码的时间，相比于函数调用的开销较大，那么效率的收获会很少。

> **每一处内联函数的调用都要复制代码，将使程序的总代码量增大，消耗更多的内存空间。**

> 以下情况不宜使用内联：

>（1）如果函数体内的 **代码比较长**，使用内联将导致内存消耗代价较高。

>（2）如果函数体内出现循环，那么执行函数体内代码的时间要比函数调用的开销大。

> 一个好的编译器将会根据函数的定义体，自动地取消不值得的内联（这进一步说明了inline 不应该出现在函数的声明中）。
